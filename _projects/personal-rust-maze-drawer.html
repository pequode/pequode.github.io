---
title: A Crabby way to draw simple mazes.  
layout: default
description: Using rust and Prims algorithm to randomly generate unique mazes.    
image: /assets/rust_maze_0.png
personal: true 
---

<h1>A Crabby way to draw simple mazes.</h1>
<p>
  Using rust and Prims algorithm to randomly generate unique mazes.
</p>

<br>

<h2>Background</h2>
<p>
  While working on a JS based video game for a personal project I decided that it would be fun to implement the maze generation in rust.
</p>
<br>
<p>
My Job focuses mostly on python and doesn't give me a lot of ability to write code in rust but I have been really impressed with the language. 
</p>
<br>
<p>
I come from a C/C++ background and Rust's memory safety and exception handling are really appealing coming from duck typing/ void* pointers.
</p>
 <br>
<p>
 I also am of the opinion that self-hosted websites work better when as much of the work of the tool is done client-side. 
  However the clear trade off is that it is hard to write fast JS and it takes up a lot of mem. Enter Wasm. Similar to 
  packages like numpy for python wasm allows JS to bind to programs written in other languages which can run on the browser. 
  It is compiled making it fast and potentially low memory. 
</p>
 <br>
 <p>
rust has a lot of great support for WASM binding so I though it would be cool to make the compute heavy maze generation step. 
happen in rust. 
 </p>
<br>
<p>
I decided to use prims algorithm to generate 32 x 32 mazes. This is a cool iterative algorithm
  that basically does BFS on a grid and dice-roll decides to remove squares if the would connect to an existing part of the maze.  
</p>
<br>
<p>
 Here is the result. 
  Refresh the page to get a new 32x32 maze.
</p>


<script type="module">
  import * as maze_gen from "/assets/scripts/pkg/maze_gen.js";

  // Initialize wasm
  await maze_gen.default();
  const seed_random = Math.round(Math.random()*100)
  // Generate maze
  const result = maze_gen.maze_maker(32, 32, 0, 1, 10, seed_random);
  console.log(result);

  function draw_canvas(grid, options = {}) {
    if (!Array.isArray(grid) || grid.length === 0) {
      throw new Error("grid must be a non-empty 2D array");
    }

    const n = grid.length;
    for (let i = 0; i < n; i++) {
      if (!Array.isArray(grid[i]) || grid[i].length !== n) {
        throw new Error("grid must be square (n x n)");
      }
    }

    const {
      cellSize = 20,
      gap = 0,
      background = "#ffffff",
      lineColor = null,
      appendTo = null,
      downloadFilename = "grid.png",
    } = options;

    const width = n * cellSize + Math.max(0, n - 1) * gap;
    const height = width;

    const canvas = document.createElement("canvas");
    canvas.width = width;
    canvas.height = height;
    canvas.style.imageRendering = "pixelated";
    const ctx = canvas.getContext("2d");

    // Fill background
    ctx.fillStyle = background;
    ctx.fillRect(0, 0, width, height);

    // Draw cells
    for (let i = 0; i < n; i++) {
      for (let j = 0; j < n; j++) {
        const value = grid[i][j];
        const x = j * (cellSize + gap);
        const y = i * (cellSize + gap);

        ctx.fillStyle = value === 0 ? "#000000" : "#ffffff";
        ctx.fillRect(x, y, cellSize, cellSize);

        if (lineColor) {
          ctx.strokeStyle = lineColor;
          ctx.lineWidth = 1;
          ctx.strokeRect(x + 0.5, y + 0.5, cellSize - 1, cellSize - 1);
        }
      }
    }

    if (appendTo instanceof Element) {
      appendTo.appendChild(canvas);
    }

    function dataURL() {
      return canvas.toDataURL("image/png");
    }

    function download(filename = downloadFilename) {
      const a = document.createElement("a");
      a.href = dataURL();
      a.download = filename;
      let el = document.getElementById("maze_cont")
      el.appendChild(a);
      
      a.click();
      a.remove();
    }

    return { canvas, ctx, dataURL, download };
  }
  let el = document.getElementById("maze_cont")
  
  // Draw maze on page
  const { download } = draw_canvas(result[0], {
    cellSize: 32,
    gap: 0,
    lineColor: "#fff",
    appendTo: el,
    downloadFilename: "maze.png"
  });

  // Add download button
  const btn = document.createElement("button");
  btn.textContent = "Download PNG";
  btn.onclick = () => download();
  
  el.appendChild(btn);
</script>
<div id="maze_cont"></div>
<h1>Skills</h1>
<ul>
  <li>Rust</li>
  <li>Js</li>
</ul>